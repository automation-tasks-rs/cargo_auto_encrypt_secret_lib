<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="encrypt_secret"><title>encrypt_secret - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="encrypt_secret" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.1 (7cf61ebde 2024-03-27)" data-channel="1.77.1" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-4c98445ec4002617.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../encrypt_secret/index.html">encrypt_secret</a><span class="version">1.0.1</span></h2></div><div class="sidebar-elems"><ul class="block">
            <li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../encrypt_secret/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">encrypt_secret</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/encrypt_secret/lib.rs.html#2-127">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="encrypt_secret"><a class="doc-anchor" href="#encrypt_secret">§</a>encrypt_secret</h2>
<p><strong>Library to encrypt/decrypt secrets</strong><br />
<em><strong>version: 1.0.1 date: 2024-04-15 author: <a href="https://bestia.dev">bestia.dev</a> repository: <a href="https://github.com/automation-tasks-rs/encrypt_secret">Github</a></strong></em></p>
<p><a href="https://crates.io/crates/encrypt_secret"><img src="https://img.shields.io/crates/v/encrypt_secret.svg" alt="crates.io" /></a>
<a href="https://docs.rs/encrypt_secret/"><img src="https://docs.rs/encrypt_secret/badge.svg" alt="Documentation" /></a>
<a href="https://lib.rs/crates/encrypt_secret/"><img src="https://img.shields.io/badge/Lib.rs-rust-orange.svg" alt="Lib.rs" /></a>
<a href="https://github.com/bestia-dev/encrypt_secret/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" /></a>
<a href="https://github.com/bestia-dev/encrypt_secret/"><img src="https://github.com/bestia-dev/encrypt_secret/workflows/RustAction/badge.svg" alt="Rust" /></a>
<img src="https://bestia.dev/webpage_hit_counter/get_svg_image/1785154337.svg" alt="Hits" /></p>
<p><a href="https://github.com/automation-tasks-rs/encrypt_secret/"><img src="https://img.shields.io/badge/Lines_in_Rust-153-green.svg" alt="Lines in Rust code" /></a>
<a href="https://github.com/automation-tasks-rs/encrypt_secret/"><img src="https://img.shields.io/badge/Lines_in_Doc_comments-176-blue.svg" alt="Lines in Doc comments" /></a>
<a href="https://github.com/automation-tasks-rs/encrypt_secret/"><img src="https://img.shields.io/badge/Lines_in_comments-34-purple.svg" alt="Lines in Comments" /></a>
<a href="https://github.com/automation-tasks-rs/encrypt_secret/"><img src="https://img.shields.io/badge/Lines_in_examples-22-yellow.svg" alt="Lines in examples" /></a>
<a href="https://github.com/automation-tasks-rs/encrypt_secret/"><img src="https://img.shields.io/badge/Lines_in_tests-148-orange.svg" alt="Lines in tests" /></a></p>
<p>Hashtags: #rustlang 
My projects on GitHub are more like a tutorial than a finished product: <a href="https://github.com/bestia-dev/tutorials_rust_wasm">bestia-dev tutorials</a>.</p>
<h3 id="secrets"><a class="doc-anchor" href="#secrets">§</a>Secrets</h3>
<p>When we write an application, every connection to any server needs to work with secrets: passwords, passkeys, passcodes, passphrases, API tokens and more.</p>
<p>Sometimes it is just fine to let the user type the password. Passwords are easy for humans to remember and type. But they are the least secure.</p>
<p>It is much better to have a long random “key” string like the API token, but no human is capable of remembering that. It means we need to store it somewhere.</p>
<p>It is theoretically impossible to store this secret 100% securely using only software. Modern computers use special chips for that. But we can make it hard and not obvious for an attacker to get the secret.</p>
<h3 id="github-api-token"><a class="doc-anchor" href="#github-api-token">§</a>GitHub API token</h3>
<p>The GitHub API token is a secret just like a password. Maybe even greater.<br />
With this API token, a maleficent actor can change basically anything in your GitHub account. You don’t want that.</p>
<p>How to protect this secret?<br />
Ok, there are some basic recommendations:</p>
<ul>
<li>Give the least permission/authorization to the API token to minimize the harm an attacker can do</li>
<li>Expire the token frequently, so old tokens are of no use</li>
<li>HTTPS is a no-brainer. Never use HTTP ever again. It is plain text over the wire.</li>
<li>Never store the token in a file as plain text</li>
<li>Plain text inside env vars can also be accessed from malware</li>
</ul>
<h3 id="symmetric-encryption"><a class="doc-anchor" href="#symmetric-encryption">§</a>Symmetric encryption</h3>
<p>We will use encryption <a href="https://docs.rs/aes-gcm/latest/aes_gcm/index.html">aes_gcm::Aes256Gcm</a> for very short strings like API tokens. So I suppose the performance is not a problem.<br />
We use a passcode of 32 bytes to encrypt a string.<br />
We can also enter a string password, that will be internally hashed into a 32-byte passcode.</p>
<h3 id="use-ssh-key-to-encrypt-token"><a class="doc-anchor" href="#use-ssh-key-to-encrypt-token">§</a>Use SSH key to encrypt token</h3>
<p>We are accustomed to working with SSH keys because of Git and SSH connection to the web servers.<br />
We already know how to create, secure and manage SSH keys. We know all about the private and public keys.<br />
We know that the private key is secured by a passphrase.<br />
We already know how to add an SSH key to ssh-agent. And we know that the use of ssh-agent makes life easier, but it has some security concerns. In most cases, this is not critical, but you have to choose your own balance between Convenience and Security.<br />
All this knowledge is already mastered because of the workflow when developing in Rust.<br />
We could use the same technique to encrypt the API token.</p>
<p>We will use the private key to sign a random seed and the result will be a new super-secret passcode.
The only way to get to this super-secret passcode is to sign the seed with the private key. We suppose that only the owner can sign with his/her private key. This is the basis of SSH key security.</p>
<p>The super-secret passcode will be used to symmetrically encrypt the token and write it to a file as text. It is much simpler to work with text files.</p>
<p>Never commit secrets to your repository. GitHub is regularly scanned for uploaded secrets. That is a big no-no. I prefer to store the encrypted token in the <code>~/.ssh</code> directory near to other secret and encrypted keys.</p>
<h3 id="create-an-ssh-key"><a class="doc-anchor" href="#create-an-ssh-key">§</a>Create an SSH key</h3>
<p>It is recommended to encrypt every API token with its dedicated SSH key. This way you have granular control over how to use it.</p>
<div class="example-wrap"><pre class="language-bash"><code>ssh-keygen -t ed25519 -C &quot;github api token&quot;
# for test type these interactively:
# file name: tests/test_github_api_token_ssh_1
# passphrase: test_passphrase
# repeat passphrase: test_passphrase
</code></pre></div><h3 id="balance-between-convenience-and-security"><a class="doc-anchor" href="#balance-between-convenience-and-security">§</a>Balance between Convenience and Security</h3>
<p>First thing first: it is theoretically impossible to secure a secret 100% only with software. If an attacker gets privileged or physical access to the computer, he can do anything. But that does not mean it is easy and quick. We can make it harder and harder to find a secret. Finally, we have to choose a balance between Convenience and Security.</p>
<p>You can choose to type the API key into the terminal every time. This is very inconvenient. You cannot remember the API key, you have to store it somewhere on the computer. And then use copy-paste. This is also a security concern. This secret token will stay in the clipboard and that is easy to extract.</p>
<p>Never store secret tokens in plain text. Nor in files nor environment variables. Files and env var are easy to upload to a malicious website. Use some kind of secret manager or encryption.</p>
<p>When the token is encrypted with SSH, it must be decrypted using the private key. The private key is secured with a passphrase. This passphrase is easy to remember and type. You can choose to type the passphrase on every use of the token. This is pretty secure but inconvenient.</p>
<p>Ultimately you can use ssh-agent to decrypt the private key only once typing the passphrase. It will work in the background for a specific time like 1 hour or until the end of the terminal session. This is not secure, because an attacker could use the same open-source code to extract the token from ssh-agent in unencrypted form. But it is tricky to do and it is time-limited.</p>
<p>Just to mention the token could be extracted from memory while in use. Or that the attacker could install a key logger and send all typed passwords and passphrases to a malicious website. There are really no limits to software exploits once the attacker has enough privilege.</p>
<p>Finally, your choice.</p>
<h3 id="open-source-and-free-as-a-beer"><a class="doc-anchor" href="#open-source-and-free-as-a-beer">§</a>Open-source and free as a beer</h3>
<p>My open-source projects are free as a beer (MIT license).<br />
I just love programming.<br />
But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer by donating to my <a href="https://paypal.me/LucianoBestia">PayPal</a>.<br />
You know the price of a beer in your local bar ;-)<br />
So I can drink a free beer for your health :-)<br />
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/">Nazdravlje!</a> 🍻</p>
<p><a href="https://bestia.dev">//bestia.dev</a><br />
<a href="https://github.com/bestia-dev">//github.com/bestia-dev</a><br />
<a href="https://bestiadev.substack.com">//bestiadev.substack.com</a><br />
<a href="https://youtube.com/@bestia-dev-tutorials">//youtube.com/@bestia-dev-tutorials</a></p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="ssh_mod/index.html" title="mod encrypt_secret::ssh_mod">ssh_mod</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="ssh_sign_crypt_mod/index.html" title="mod encrypt_secret::ssh_sign_crypt_mod">ssh_sign_crypt_mod</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">How to save a GitHub TOKEN securely inside a file?</div></li><li><div class="item-name"><a class="mod" href="symmetric_crypt_mod/index.html" title="mod encrypt_secret::symmetric_crypt_mod">symmetric_crypt_mod</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="mod" href="utils_mod/index.html" title="mod encrypt_secret::utils_mod">utils_mod</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">various utilities</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.EncryptedString.html" title="struct encrypt_secret::EncryptedString">EncryptedString</a></div><div class="desc docblock-short">A simple wrapper new-type around String just to show intent that it is already encrypted</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.decrypt_symmetric.html" title="fn encrypt_secret::decrypt_symmetric">decrypt_symmetric</a></div><div class="desc docblock-short">Decrypts encrypted_string with secret_passcode_bytes</div></li><li><div class="item-name"><a class="fn" href="fn.decrypt_symmetric_with_password.html" title="fn encrypt_secret::decrypt_symmetric_with_password">decrypt_symmetric_with_password</a></div><div class="desc docblock-short">Decrypts encrypted_string with secret_password</div></li><li><div class="item-name"><a class="fn" href="fn.decrypt_with_ssh_interactive_from_file.html" title="fn encrypt_secret::decrypt_with_ssh_interactive_from_file">decrypt_with_ssh_interactive_from_file</a></div><div class="desc docblock-short">Decrypt token from file (json encoded in Base64) with the chosen ssh_identity</div></li><li><div class="item-name"><a class="fn" href="fn.encrypt_symmetric.html" title="fn encrypt_secret::encrypt_symmetric">encrypt_symmetric</a></div><div class="desc docblock-short">Encrypts secret_string with secret_passcode_bytes</div></li><li><div class="item-name"><a class="fn" href="fn.encrypt_symmetric_with_password.html" title="fn encrypt_secret::encrypt_symmetric_with_password">encrypt_symmetric_with_password</a></div><div class="desc docblock-short">Encrypts secret_string with secret_password</div></li><li><div class="item-name"><a class="fn" href="fn.encrypt_with_ssh_interactive_save_file.html" title="fn encrypt_secret::encrypt_with_ssh_interactive_save_file">encrypt_with_ssh_interactive_save_file</a></div><div class="desc docblock-short">Encrypt token with the chosen ssh_identity and save as json encoded in Base64</div></li></ul></section></div></main></body></html>